# ════════════════════════════════════════════════════════════════════════════
# LIQSOL - Professional Live Runner Configuration
# ════════════════════════════════════════════════════════════════════════════
# This file contains the minimal configuration needed to run bot:live
# Organized by category for clarity

# ════════════════════════════════════════════════════════════════════════════
# NETWORK CONFIGURATION
# ════════════════════════════════════════════════════════════════════════════
RPC_PRIMARY=https://api.mainnet-beta.solana.com
RPC_SECONDARY=
WS_PRIMARY=
WS_SECONDARY=

# ════════════════════════════════════════════════════════════════════════════
# YELLOWSTONE GRPC (For real-time events)
# ════════════════════════════════════════════════════════════════════════════
YELLOWSTONE_GRPC_URL=https://solana-mainnet.g.alchemy.com/
YELLOWSTONE_X_TOKEN=your-alchemy-token-here

# ════════════════════════════════════════════════════════════════════════════
# KAMINO PROTOCOL
# ════════════════════════════════════════════════════════════════════════════
KAMINO_MARKET_PUBKEY=7u3HeHxYDLhnCoErrtycNokbQYbWGzLs6JSDqGAv5PfF
KAMINO_KLEND_PROGRAM_ID=KLend2g3cP87fffoy8q1mQqGKjrxjC8boSyAYavgmjD

# ════════════════════════════════════════════════════════════════════════════
# BOT CONFIGURATION
# ════════════════════════════════════════════════════════════════════════════
BOT_KEYPAIR_PATH=/path/to/keypair.json
LOG_LEVEL=info
# When set to 1, dumps obligation slot breakdown and compiled refreshObligation account list on Custom(6006)
DEBUG_REFRESH_OBLIGATION=0
NODE_ENV=development

# ════════════════════════════════════════════════════════════════════════════
# DATA PATHS (default values shown, usually not needed to override)
# ════════════════════════════════════════════════════════════════════════════
# OBLIGATIONS_PATH=data/obligations.jsonl
# CANDIDATES_PATH=data/candidates.json
# QUEUE_PATH=data/tx_queue.json

# ════════════════════════════════════════════════════════════════════════════
# ALLOWLIST (Optional - execution filter for repay/collateral legs)
# ════════════════════════════════════════════════════════════════════════════
# Execution allowlist only. Controls which repay/collateral mints we'll build.
# Scoring now loads ALL reserves/oracles and values full portfolios.
# Comma-separated mint addresses. Empty = disabled (no restriction on legs)
# Example: SOL and USDC only
# LIQSOL_EXEC_MINT_ALLOWLIST=So11111111111111111111111111111111111111112,EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v
# Backward-compatible fallback:
# LIQSOL_LIQ_MINT_ALLOWLIST=So11111111111111111111111111111111111111112,EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v

# Health source selection (optional)
# If unset: protocol-first (recommended for live; avoids false liquidatables)
# protocol: use program SF values
# recomputed: use oracle+reserve recompute (debug/forecast)
# LIQSOL_HEALTH_SOURCE=protocol

# ════════════════════════════════════════════════════════════════════════════
# LIVE RUNNER - CANDIDATE REFRESH
# ════════════════════════════════════════════════════════════════════════════
# How often to rebuild candidates.json and tx_queue.json (milliseconds)
LIVE_CANDIDATE_REFRESH_INTERVAL_MS=120000

# Queue build mode: 'replace' (recommended for production) or 'merge' (for testing)
# Replace mode: Atomically replaces entire queue with new plans (no stale plans)
# Merge mode: Merges new plans with existing queue (legacy behavior)
QUEUE_BUILD_MODE=replace

# ════════════════════════════════════════════════════════════════════════════
# SCHEDULER THRESHOLDS
# ════════════════════════════════════════════════════════════════════════════
# TTL (Time-to-liquidation) configuration
TTL_GRACE_MS=60000
TTL_UNKNOWN_PASSES=true

# Minimum expected value to include in queue (USD)
SCHED_MIN_EV=0

# Maximum TTL to include in queue (minutes)
SCHED_MAX_TTL_MIN=999999

# Minimum hazard score to include in queue
SCHED_MIN_HAZARD=0

# Force-include liquidatable obligations regardless of thresholds
SCHED_FORCE_INCLUDE_LIQUIDATABLE=false

# Pre-reserve refresh strategy for liquidation builder (all|primary|auto)
PRE_RESERVE_REFRESH_MODE=auto
PRE_RESERVE_FULL_REFRESH_MAX_RESERVES=6

# Heartbeat interval for audit/logging (milliseconds)
SCHED_HEARTBEAT_INTERVAL_MS=60000

# Scheduler component flags
SCHEDULER_ENABLE_EXECUTOR=true
SCHEDULER_ENABLE_AUDIT=true
SCHEDULER_ENABLE_REFRESH=false

# ════════════════════════════════════════════════════════════════════════════
# EVENT-DRIVEN REFRESH
# ════════════════════════════════════════════════════════════════════════════
# Minimum health delta to trigger refresh (e.g., 0.01 = 1% change)
MIN_HEALTH_DELTA=0.01

# Minimum time between refreshes per obligation (milliseconds)
EVENT_MIN_REFRESH_INTERVAL_MS=3000

# Maximum number of obligations to refresh per batch
EVENT_REFRESH_BATCH_LIMIT=50

# ════════════════════════════════════════════════════════════════════════════
# EXECUTION CONFIGURATION
# ════════════════════════════════════════════════════════════════════════════
# Broadcasting mode: false = dry-run (simulate), true = broadcast (real txs)
LIQSOL_BROADCAST=false

# Compute unit limit per transaction
EXEC_CU_LIMIT=600000

# Compute unit price in microlamports (priority fee)
EXEC_CU_PRICE=0

# Execution thresholds (filters plans before execution)
EXEC_MIN_EV=0
EXEC_MAX_TTL_MIN=999999
EXEC_MIN_FEE_PAYER_SOL=0.05
# Dry-run setup-required cache TTL in seconds (0 disables cache)
EXEC_DRY_RUN_SETUP_CACHE_TTL_SECONDS=300

# ════════════════════════════════════════════════════════════════════════════
# SWAP CONFIGURATION (Jupiter)
# ════════════════════════════════════════════════════════════════════════════
# Slippage tolerance in basis points (100 = 1%)
SWAP_SLIPPAGE_BPS=100
JUPITER_AS_LEGACY_TRANSACTION=false

# Safety haircut for estimated seized collateral (100 = 1%)
SWAP_IN_HAIRCUT_BPS=100

# ════════════════════════════════════════════════════════════════════════════
# CANDIDATE SELECTION
# ════════════════════════════════════════════════════════════════════════════
# Maximum number of top candidates to select
CAND_TOP=50

# Near-liquidation threshold (health ratio <= this is "near")
CAND_NEAR=1.02

# Number of candidates to validate with detailed breakdown (0 = disabled)
CAND_VALIDATE_SAMPLES=0

# ════════════════════════════════════════════════════════════════════════════
# FORECAST TTL MANAGEMENT
# ════════════════════════════════════════════════════════════════════════════
FORECAST_MAX_AGE_MS=300000
SCHED_MIN_REFRESH_INTERVAL_MS=60000
SCHED_EV_DROP_PCT=0.15

# TTL prediction parameters
TTL_SOL_DROP_PCT_PER_MIN=0.2
TTL_MAX_DROP_PCT=20
HAZARD_ALPHA=25

# ════════════════════════════════════════════════════════════════════════════
# EXPECTED VALUE (EV) PARAMETERS
# ════════════════════════════════════════════════════════════════════════════
EV_CLOSE_FACTOR=0.5
EV_LIQUIDATION_BONUS_PCT=0.05
EV_FLASHLOAN_FEE_PCT=0.002
EV_FIXED_GAS_USD=0.5
# EV_SLIPPAGE_BUFFER_PCT=0.02

# ════════════════════════════════════════════════════════════════════════════
# ORACLE CONFIGURATION (Advanced)
# ════════════════════════════════════════════════════════════════════════════
# Scope oracle fallback scanning (allowlist-only)
# Only set to "1" to enable bounded curated chain scan for <=5 allowlisted mints
# Ignored in full-market mode to prevent systematic mispricing
# Default: not set (disabled)
# LIQSOL_ENABLE_SCOPE_SCAN=1

# Oracle staleness thresholds (seconds)
# Reject oracle prices older than these thresholds
# Pyth: strict (updates frequently, ~every slot)
# Switchboard/Scope: looser (multi-hop chains use oldest-hop timestamp, less frequent updates)
# Default: Pyth=30, Switchboard=120, Scope=120
LIQSOL_PYTH_MAX_AGE_SECONDS=30
LIQSOL_SWITCHBOARD_MAX_AGE_SECONDS=120
LIQSOL_SCOPE_MAX_AGE_SECONDS=120

# Enable stablecoin price clamping to [0.99, 1.01] range (1 = enabled)
# CLAMP_STABLECOINS=1

# ════════════════════════════════════════════════════════════════════════════
# SNAPSHOT CONFIGURATION (for snapshot:obligations command)
# ════════════════════════════════════════════════════════════════════════════
SNAPSHOT_MAX_SECONDS=180
SNAPSHOT_INACTIVITY_SECONDS=30

# ════════════════════════════════════════════════════════════════════════════
# BROADCAST RETRY CONFIGURATION (Advanced)
# ════════════════════════════════════════════════════════════════════════════
# Maximum send attempts per transaction
BOT_MAX_ATTEMPTS_PER_PLAN=2

# Compute budget bump factors on retry
# CU_LIMIT_BUMP_FACTOR=1.5
# CU_PRICE_BUMP_MICROLAMPORTS=50000

# ════════════════════════════════════════════════════════════════════════════
# MISC (usually not needed)
# ════════════════════════════════════════════════════════════════════════════
USE_FORECAST_FOR_DRYRUN=false
FORECAST_WEIGHT_EV=0.75
FORECAST_WEIGHT_TTL=0.25
INDEXER_INTERVAL_MS=5000
SCHED_MAX_QUEUE_SIZE=100
SCHED_MAX_PLANS_PER_CYCLE=100
SCHED_REFRESH_BATCH_LIMIT=25
PRESUBMIT_ENABLED=false
PRESUBMIT_TOPK=5
PRESUBMIT_REFRESH_MS=3000
PRESUBMIT_TTL_MS=60000
BOT_MAX_INFLIGHT=1
BOT_MAX_ATTEMPTS_PER_CYCLE=10
SCHEDULED_MIN_LIQUIDATION_DELAY_MS=0
SWAP_SIZING_FALLBACK_ENABLED=true
