# ════════════════════════════════════════════════════════════════════════════
# LIQSOL - Professional Live Runner Configuration
# ════════════════════════════════════════════════════════════════════════════
# This file contains the minimal configuration needed to run bot:live
# Organized by category for clarity

# ════════════════════════════════════════════════════════════════════════════
# NETWORK CONFIGURATION
# ════════════════════════════════════════════════════════════════════════════
RPC_PRIMARY=https://api.mainnet-beta.solana.com
RPC_SECONDARY=
WS_PRIMARY=
WS_SECONDARY=

# ════════════════════════════════════════════════════════════════════════════
# YELLOWSTONE GRPC (For real-time events)
# ════════════════════════════════════════════════════════════════════════════
YELLOWSTONE_GRPC_URL=https://solana-mainnet.g.alchemy.com/
YELLOWSTONE_X_TOKEN=your-alchemy-token-here

# ════════════════════════════════════════════════════════════════════════════
# KAMINO PROTOCOL
# ════════════════════════════════════════════════════════════════════════════
KAMINO_MARKET_PUBKEY=7u3HeHxYDLhnCoErrtycNokbQYbWGzLs6JSDqGAv5PfF
KAMINO_KLEND_PROGRAM_ID=KLend2g3cP87fffoy8q1mQqGKjrxjC8boSyAYavgmjD

# ════════════════════════════════════════════════════════════════════════════
# BOT CONFIGURATION
# ════════════════════════════════════════════════════════════════════════════
BOT_KEYPAIR_PATH=/path/to/keypair.json
LOG_LEVEL=info
NODE_ENV=development

# ════════════════════════════════════════════════════════════════════════════
# DATA PATHS (default values shown, usually not needed to override)
# ════════════════════════════════════════════════════════════════════════════
# OBLIGATIONS_PATH=data/obligations.jsonl
# CANDIDATES_PATH=data/candidates.json
# QUEUE_PATH=data/tx_queue.json

# ════════════════════════════════════════════════════════════════════════════
# ALLOWLIST (Optional - filter by liquidity mints)
# ════════════════════════════════════════════════════════════════════════════
# Comma-separated mint addresses. Empty = disabled (score all obligations)
# Example: SOL and USDC only
# LIQSOL_LIQ_MINT_ALLOWLIST=So11111111111111111111111111111111111111112,EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v

# ════════════════════════════════════════════════════════════════════════════
# LIVE RUNNER - CANDIDATE REFRESH
# ════════════════════════════════════════════════════════════════════════════
# How often to rebuild candidates.json and tx_queue.json (milliseconds)
LIVE_CANDIDATE_REFRESH_INTERVAL_MS=120000

# ════════════════════════════════════════════════════════════════════════════
# SCHEDULER THRESHOLDS
# ════════════════════════════════════════════════════════════════════════════
# TTL (Time-to-liquidation) configuration
TTL_GRACE_MS=60000
TTL_UNKNOWN_PASSES=true

# Minimum expected value to include in queue (USD)
SCHED_MIN_EV=0

# Maximum TTL to include in queue (minutes)
SCHED_MAX_TTL_MIN=999999

# Minimum hazard score to include in queue
SCHED_MIN_HAZARD=0

# Force-include liquidatable obligations regardless of thresholds
SCHED_FORCE_INCLUDE_LIQUIDATABLE=true

# Heartbeat interval for audit/logging (milliseconds)
SCHED_HEARTBEAT_INTERVAL_MS=60000

# Scheduler component flags
SCHEDULER_ENABLE_EXECUTOR=true
SCHEDULER_ENABLE_AUDIT=true
SCHEDULER_ENABLE_REFRESH=false

# ════════════════════════════════════════════════════════════════════════════
# EVENT-DRIVEN REFRESH
# ════════════════════════════════════════════════════════════════════════════
# Minimum health delta to trigger refresh (e.g., 0.01 = 1% change)
MIN_HEALTH_DELTA=0.01

# Minimum time between refreshes per obligation (milliseconds)
EVENT_MIN_REFRESH_INTERVAL_MS=3000

# Maximum number of obligations to refresh per batch
EVENT_REFRESH_BATCH_LIMIT=50

# ════════════════════════════════════════════════════════════════════════════
# EXECUTION CONFIGURATION
# ════════════════════════════════════════════════════════════════════════════
# Broadcasting mode: false = dry-run (simulate), true = broadcast (real txs)
LIQSOL_BROADCAST=false

# Compute unit limit per transaction
EXEC_CU_LIMIT=600000

# Compute unit price in microlamports (priority fee)
EXEC_CU_PRICE=0

# Execution thresholds (filters plans before execution)
EXEC_MIN_EV=0
EXEC_MAX_TTL_MIN=999999

# ════════════════════════════════════════════════════════════════════════════
# SWAP CONFIGURATION (Jupiter)
# ════════════════════════════════════════════════════════════════════════════
# Slippage tolerance in basis points (100 = 1%)
SWAP_SLIPPAGE_BPS=100

# Safety haircut for estimated seized collateral (100 = 1%)
SWAP_IN_HAIRCUT_BPS=100

# ════════════════════════════════════════════════════════════════════════════
# CANDIDATE SELECTION
# ════════════════════════════════════════════════════════════════════════════
# Maximum number of top candidates to select
CAND_TOP=50

# Near-liquidation threshold (health ratio <= this is "near")
CAND_NEAR=1.02

# Number of candidates to validate with detailed breakdown (0 = disabled)
CAND_VALIDATE_SAMPLES=0

# ════════════════════════════════════════════════════════════════════════════
# FORECAST TTL MANAGEMENT
# ════════════════════════════════════════════════════════════════════════════
FORECAST_MAX_AGE_MS=300000
SCHED_MIN_REFRESH_INTERVAL_MS=60000
SCHED_EV_DROP_PCT=0.15

# TTL prediction parameters
TTL_SOL_DROP_PCT_PER_MIN=0.2
TTL_MAX_DROP_PCT=20
HAZARD_ALPHA=25

# ════════════════════════════════════════════════════════════════════════════
# EXPECTED VALUE (EV) PARAMETERS
# ════════════════════════════════════════════════════════════════════════════
EV_CLOSE_FACTOR=0.5
EV_LIQUIDATION_BONUS_PCT=0.05
EV_FLASHLOAN_FEE_PCT=0.002
EV_FIXED_GAS_USD=0.5
# EV_SLIPPAGE_BUFFER_PCT=0.02

# ════════════════════════════════════════════════════════════════════════════
# ORACLE CONFIGURATION (Advanced)
# ════════════════════════════════════════════════════════════════════════════
# Enable full curated chain scanning for Scope oracles (1 = enabled)
# LIQSOL_ENABLE_SCOPE_SCAN=1

# Enable stablecoin price clamping to [0.99, 1.01] range (1 = enabled)
# CLAMP_STABLECOINS=1

# ════════════════════════════════════════════════════════════════════════════
# SNAPSHOT CONFIGURATION (for snapshot:obligations command)
# ════════════════════════════════════════════════════════════════════════════
SNAPSHOT_MAX_SECONDS=180
SNAPSHOT_INACTIVITY_SECONDS=30

# ════════════════════════════════════════════════════════════════════════════
# BROADCAST RETRY CONFIGURATION (Advanced)
# ════════════════════════════════════════════════════════════════════════════
# Maximum send attempts per transaction
BOT_MAX_ATTEMPTS_PER_PLAN=2

# Compute budget bump factors on retry
# CU_LIMIT_BUMP_FACTOR=1.5
# CU_PRICE_BUMP_MICROLAMPORTS=50000

# ════════════════════════════════════════════════════════════════════════════
# MISC (usually not needed)
# ════════════════════════════════════════════════════════════════════════════
USE_FORECAST_FOR_DRYRUN=false
FORECAST_WEIGHT_EV=0.75
FORECAST_WEIGHT_TTL=0.25
INDEXER_INTERVAL_MS=5000
SCHED_MAX_QUEUE_SIZE=100
SCHED_MAX_PLANS_PER_CYCLE=100
SCHED_REFRESH_BATCH_LIMIT=25
PRESUBMIT_TOP_K=10
PRESUBMIT_REFRESH_MS=3000
PRESUBMIT_TTL_MS=60000
BOT_MAX_INFLIGHT=1
BOT_MAX_ATTEMPTS_PER_CYCLE=10
SCHEDULED_MIN_LIQUIDATION_DELAY_MS=0
SWAP_SIZING_FALLBACK_ENABLED=true

# CAND_NEAR: Near-liquidation threshold (default: 1.02, i.e., health ratio <= 1.02 is "near")
# CAND_VALIDATE_SAMPLES: Number of candidates to validate with detailed breakdown (default: 0)
CAND_TOP=50
CAND_NEAR=1.02
CAND_VALIDATE_SAMPLES=0

# PR11: Forecast TTL management and EV-based refresh thresholds
FORECAST_MAX_AGE_MS=300000
SCHED_REFRESH_INTERVAL_MS=30000
SCHED_EV_DROP_PCT=0.15
SCHED_MIN_REFRESH_INTERVAL_MS=60000

# TTL expiry configuration
# TTL_GRACE_MS: Grace period (ms) after predicted liquidation time before marking as expired (default: 60000 = 60s)
# TTL_UNKNOWN_PASSES: Whether to allow plans with unknown TTL through eligibility filter (default: true)
TTL_GRACE_MS=60000
TTL_UNKNOWN_PASSES=true

# PR12: Scheduler batch limit for refresh queue
SCHED_REFRESH_BATCH_LIMIT=25

# Execution thresholds (PR13)
EXEC_MIN_EV=0
EXEC_MAX_TTL_MIN=999999
SCHEDULED_MIN_LIQUIDATION_DELAY_MS=0

# PR2: Executor configuration
EXEC_CU_LIMIT=600000
EXEC_CU_PRICE=0
JUPITER_SLIPPAGE_BPS=50

# Final PR: Jupiter swap sizing configuration
# SWAP_SLIPPAGE_BPS: Slippage tolerance for Jupiter swaps in basis points (default: 100 = 1%)
# SWAP_IN_HAIRCUT_BPS: Safety haircut applied to estimated seized collateral (default: 100 = 1%)
#   This prevents oversizing swaps if estimation is slightly off
# SWAP_SIZING_FALLBACK_ENABLED: Enable fallback to liquidation-only if swap sizing fails (default: true)
#   When true, bot proceeds with liquidation-only (no swap) if seized-delta estimation fails
#   When false, bot fails-fast and skips the plan entirely
SWAP_SLIPPAGE_BPS=100
SWAP_IN_HAIRCUT_BPS=100
SWAP_SIZING_FALLBACK_ENABLED=true

# Final PR: Presubmitter cache configuration
# PRESUBMIT_TOP_K: Number of top plans to prebuild and cache (default: 10)
# PRESUBMIT_REFRESH_MS: Minimum refresh interval per obligation in milliseconds (default: 3000)
# PRESUBMIT_TTL_MS: Maximum age of cached transactions in milliseconds (default: 60000)
PRESUBMIT_TOP_K=10
PRESUBMIT_REFRESH_MS=3000
PRESUBMIT_TTL_MS=60000

# Final PR: Compute unit and priority fee configuration for broadcast retries
# CU_LIMIT: Compute unit limit per transaction (default: 600000)
# CU_PRICE_MICROLAMPORTS: Priority fee in microlamports per CU (default: 0)
#   Set higher for faster execution during network congestion
CU_LIMIT=600000
CU_PRICE_MICROLAMPORTS=0

# PR2: Bot configuration
BOT_MAX_INFLIGHT=1
BOT_MAX_ATTEMPTS_PER_CYCLE=10
LIQSOL_BROADCAST=false

# Final PR: Broadcast retry configuration
# BOT_MAX_ATTEMPTS_PER_PLAN: Max send attempts per transaction (default: 2)
#   Retries happen on blockhash expired, compute exceeded, or priority issues
BOT_MAX_ATTEMPTS_PER_PLAN=2

# Scheduler main loop flags (PR14)
SCHEDULER_ENABLE_REFRESH=true
SCHEDULER_ENABLE_AUDIT=true
# SCHEDULER_ENABLE_DRYRUN: Controls whether executor runs at all (not the execution mode).
# Set to false to disable executor entirely. Use LIQSOL_BROADCAST to control dry-run vs broadcast mode.
# Note: This is a legacy flag name. The clearer name SCHEDULER_ENABLE_EXECUTOR is preferred but this
# name is maintained for backward compatibility. Default: true
SCHEDULER_ENABLE_DRYRUN=true
# SCHEDULER_ENABLE_EXECUTOR=true  # Preferred alternative to SCHEDULER_ENABLE_DRYRUN (takes precedence if set)
SCHEDULER_MAIN_INTERVAL_MS=30000

# PR14.1: Yellowstone gRPC and real-time refresh configuration
# YELLOWSTONE_GRPC_URL is already defined above
OBLIGATION_PUBKEYS=kgpZaovQNKALCNyxUFuoPj4kSqm6YQz5H4qXgM5p61d
PRICE_ASSET_MINTS=So11111111111111111111111111111111111111112,EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v

# Event significance thresholds and throttling
MIN_PRICE_PCT_CHANGE=1.0
MIN_HEALTH_DELTA=0.01
EVENT_MIN_REFRESH_INTERVAL_MS=3000

# Optional heartbeat audit interval (ms)
SCHED_HEARTBEAT_INTERVAL_MS=60000